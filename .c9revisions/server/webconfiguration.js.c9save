{"ts":1377725288633,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var env = require('rekuire')(\"env\");\r\nvar express = require('express');\r\nvar ect = require('ect');\r\nvar logger = require('winston');\r\nvar passport = require('passport');\r\nvar SignInService = env.require(\"/server/service/SignInService\");\r\nvar GoogleStrategy = require('passport-google-oauth').OAuth2Strategy;\r\n\r\nvar templateDirectory = env.root + '/web/views';\r\n\r\nvar app = express();\r\n\r\napp.configure(function() {\r\n  \r\n  app.set('json spaces', 0);\r\n  \r\n  // ECT\r\n  app.set('views', templateDirectory);\r\n  app.engine('.ect', ect({ watch: true, root: templateDirectory }).render);\r\n\r\n  // Express\r\n  app.use(express.compress());\r\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true }));\r\n  app.use(\"/static\", express.static(env.root + '/web/resources', { maxAge: 1000*60*60*24*30*12  }));\r\n  app.use(express.logger());\r\n\r\n  app.use(express.cookieParser());\r\n  app.use(express.bodyParser());\r\n  \r\n  app.use(express.session({   \r\n      secret: 'SOMETHING_REALLY_HARD_TO_GUESS',   \r\n      cookie: {  \r\n        path     : '/',  \r\n        maxAge   : 1000*60*60*24*30*12    //one year(ish)  \r\n      }   \r\n    }));\r\n\r\n  \r\n  // Passport\r\n  app.use(passport.initialize());\r\n  app.use(passport.session());\r\n  \r\n  app.use(app.router);  \r\n});\r\n\r\npassport.use(new GoogleStrategy({\r\n    clientID: env.google.clientID,\r\n    clientSecret: env.google.clientSecret,\r\n    callbackURL: env.host + \"/auth/google/callback\"\r\n  }, SignInService.signIn));\r\n\r\npassport.serializeUser(function(user, done) {\r\n    done(undefined, user);\r\n});\r\n\r\npassport.deserializeUser(function(user, done) {\r\n    done(undefined, user);\r\n});\r\n\r\n\r\nmodule.exports = {'app' : app, 'ect' : ect};\r\n"]],"start1":0,"start2":0,"length1":0,"length2":1665}]],"length":1665}
